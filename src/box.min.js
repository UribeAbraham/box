!function(t,o){t.fn.box=function(i){var e={width:0,height:0,ref:!1,title:!1,closebutton:!0,type:"img",caption:!1,onStart:!1,onLoad:!1,onClose:!1,onError:!1},n=t("body"),h=t(o),s=t("html");t("html")[0].scrollHeight<t("body")[0].scrollHeight&&(s=n);var r={init:function(o){return o=t.extend({},e,o||{}),this.each(function(){var i=this,e=t.extend({},o);e.ref=t(i).attr("href")||e.ref,e.title=t(i).attr("title")||e.title;var r=t("<div class='loading'>"),c=t("<div class='box'>"),a=t(new Image),l=t("<div class='boxcontent'>"),u=t("<span class='close'>"),f=t("<p class='caption'>"+e.title+"</p>"),d=function(){r.fadeOut("fast",function(){t(this).remove()})},g=function(){e.closebutton&&(l.append(u),i.box.closebutton=u)},p=function(){e.caption&&e.title&&(l.append(f),i.box.title=f)};if(u.click(function(){t(i).box("close")}),i.box=e,""==s.css("overflow")?(""!=s.css("overflow-x")&&(i.box.overflowx=s.css("overflow-x")),""!=s.css("overflow-y")&&(i.box.overflowy=s.css("overflow-y"))):i.box.overflow=s.css("overflow"),n.append(c),s.css({overflow:"hidden"}),c.css({top:h.scrollTop(),left:h.scrollLeft()}).click(function(){t(i).box("close")}),i.box.overlay=c,c.append(r),r.css({display:"block",position:"absolute",left:h.width()/2-r.width()/2,top:h.height()/2-r.height()/2}).click(function(t){t.stopPropagation()}),h.resize(function(){r.css({left:h.width()/2-r.width()/2,top:h.height()/2-r.height()/2})}),i.box.loading=r,c.append(l),l.click(function(t){t.stopPropagation()}),i.box.container=l,t.isFunction(e.onStart))var x=e.onStart(i.box);if("img"==e.type)a.load(function(){d(),l.append(a),i.box.image=a,g(),p();var o=h.height()/2;if(0==i.box.width&&0==i.box.height){i.box.width=this.width,i.box.height=this.height;var n=function(){o=h.height()/2,h.width()<i.box.width?(l.css({width:"90%",height:"auto"}),a.css({width:"100%",height:"auto"}),l.css({top:function(){return o-l.height()/2},height:l.height()}),a.css({height:"100%"}),a.height()>h.height()&&(l.css({height:"90%",top:function(){return o-l.height()/2}}),a.css({height:"100%",width:"auto"}),l.css({width:a.width()}))):h.height()<i.box.height?(l.css({height:"90%",top:function(){return o-l.height()/2}}),a.css({height:"100%",width:"auto"}),l.css({width:a.width()}),a.css({width:"100%"}),a.width()>h.width()&&(l.css({width:"90%",height:"auto"}),a.css({width:"100%",height:"auto"}),l.css({top:function(){return o-l.height()/2}}))):(l.css({width:i.box.width,height:i.box.height,top:function(){return o-i.box.height/2}}),a.css({width:"100%",height:"100%"}))};n(),h.resize(function(){n()})}else a.css({width:function(){return 0!=i.box.width?i.box.width:"auto"},height:function(){return 0!=i.box.height?i.box.height:"auto"}}),l.css({width:a.width(),height:a.height()}),c.css({overflow:"auto"}),l.css(l.height()>h.height()?{top:"0px"}:{top:function(){return o-l.height()/2}}),h.resize(function(){l.css({top:h.height()/2-l.height()/2})});x&&x.promise?x.done(function(){t.isFunction(e.onLoad)&&e.onLoad(i.box)}):t.isFunction(e.onLoad)&&e.onLoad(i.box)}).attr({src:e.ref}).error(function(){if(d(),t.isFunction(i.box.onError))i.box.onError(i.box);else{l.html("Error").addClass("error"),l.css({display:""});var o=t(this).height()/2;l.css({top:function(){return h.height()/2-o}}),g(),h.resize(function(){l.css({top:function(){return h.height()/2-o}})})}});else if(e.type="html"){g();var b=t("<span>");l.append(b),b.load(e.ref,function(o,n,h){if(d(),"error"==n){var s="Sorry but there was an error: ";b.html(s+h.status+" "+h.statusText)}x&&x.promise?x.done(function(){t.isFunction(e.onLoad)&&e.onLoad(i.box)}):t.isFunction(e.onLoad)&&e.onLoad(i.box)}),p()}})},close:function(){return this.each(function(){var o,i,e=this;o=function(){s.css(e.box.overflow?{overflow:e.box.overflow}:{"overflow-x":e.box.overflowx,"overflow-y":e.box.overflowy}),e.box.overlay.remove()},t.isFunction(e.box.onClose)?(i=e.box.onClose(e.box),i&&i.promise?i.done(function(){o()}):o()):o()})}};return r[i]?r[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?void t.error("Method "+i+" does not exist on jQuery.box"):r.init.apply(this,arguments)}}(jQuery,window);